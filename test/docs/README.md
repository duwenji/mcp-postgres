# pytest ãƒ†ã‚¹ãƒˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

ã“ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«ã¯ã€PostgreSQL MCP Serverãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®pytestã«é–¢ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒå«ã¾ã‚Œã¦ã„ã¾ã™ã€‚

## ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

### ğŸ“š ä¸»è¦ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[pytest_concepts_and_usage.md](pytest_concepts_and_usage.md)** - pytestã®åŒ…æ‹¬çš„ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆã¨ä½¿ã„æ–¹ã‚¬ã‚¤ãƒ‰
  - pytestã®åŸºæœ¬æ¦‚å¿µ
  - ãƒ†ã‚¹ãƒˆã®æ›¸ãæ–¹ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹
  - Fixtureã€ãƒãƒ¼ã‚«ãƒ¼ã€ãƒ¢ãƒƒã‚¯ã®ä½¿ç”¨æ–¹æ³•
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå›ºæœ‰ã®è¨­å®šã¨ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

- **[pytest_example_test.py](pytest_example_test.py)** - å®Ÿè·µçš„ãªãƒ†ã‚¹ãƒˆä¾‹
  - æ§˜ã€…ãªpytestæ©Ÿèƒ½ã®å®Ÿè£…ä¾‹
  - å®Ÿéš›ã«å®Ÿè¡Œå¯èƒ½ãªãƒ†ã‚¹ãƒˆã‚³ãƒ¼ãƒ‰
  - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«åŸºã¥ã„ãŸä¾‹

- **[uv_build_migration_guide.md](uv_build_migration_guide.md)** - uvãƒ“ãƒ«ãƒ‰ã‚·ã‚¹ãƒ†ãƒ ç§»è¡Œã‚¬ã‚¤ãƒ‰
  - hatchlingã‹ã‚‰uv_buildã¸ã®ç§»è¡Œè©³ç´°
  - `uv run mcp-postgres`ãŒå‹•ä½œã™ã‚‹ä»•çµ„ã¿
  - ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸æ§‹é€ ã¨ã‚¹ã‚¯ãƒªãƒ—ãƒˆç™»éŒ²ã®æŠ€è¡“çš„è©³ç´°

### ğŸ“‹ è£œåŠ©ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **[run_tests_bat_explanation.md](run_tests_bat_explanation.md)** - ãƒ†ã‚¹ãƒˆå®Ÿè¡Œã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è©³ç´°èª¬æ˜

## ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### åŸºæœ¬çš„ãªãƒ†ã‚¹ãƒˆå®Ÿè¡Œ

```bash
# ã™ã¹ã¦ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ
uv run pytest

# ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
uv run pytest test/unit/ -v

# çµ±åˆãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œï¼ˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç’°å¢ƒãŒå¿…è¦ï¼‰
set RUN_INTEGRATION_TESTS=1
uv run pytest test/integration/ -v
```

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆä½¿ç”¨

```bash
# Windows
test\run_tests.bat unit          # ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
test\run_tests.bat integration   # çµ±åˆãƒ†ã‚¹ãƒˆ
test\run_tests.bat docker        # Dockerç’°å¢ƒã§å®Ÿè¡Œ
test\run_tests.bat all           # å…¨ãƒ†ã‚¹ãƒˆï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼‰

# Linux/macOS
test/run_tests.sh unit
test/run_tests.sh integration
test/run_tests.sh docker
test/run_tests.sh all
```

## ä¸»è¦ãªã‚³ãƒ³ã‚»ãƒ—ãƒˆ

### ãƒ†ã‚¹ãƒˆã®ç¨®é¡

1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ** (`test/unit/`)
   - å€‹ã€…ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
   - å¤–éƒ¨ä¾å­˜é–¢ä¿‚ãªã—
   - é«˜é€Ÿãªãƒ•ã‚£ãƒ¼ãƒ‰ãƒãƒƒã‚¯

2. **çµ±åˆãƒ†ã‚¹ãƒˆ** (`test/integration/`)
   - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–“ã®é€£æºãƒ†ã‚¹ãƒˆ
   - å®Ÿéš›ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶š
   - `@pytest.mark.integration` ãƒãƒ¼ã‚«ãƒ¼ä»˜ã

### é‡è¦ãªFixture

- `test_database_config` - ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹è¨­å®š
- `event_loop` - éåŒæœŸãƒ†ã‚¹ãƒˆç”¨ã‚¤ãƒ™ãƒ³ãƒˆãƒ«ãƒ¼ãƒ—
- `setup_test_environment` - è‡ªå‹•ç’°å¢ƒè¨­å®š

### ã‚«ã‚¹ã‚¿ãƒ ãƒãƒ¼ã‚«ãƒ¼

- `@pytest.mark.integration` - çµ±åˆãƒ†ã‚¹ãƒˆ
- `@pytest.mark.unit` - ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ
- `@pytest.mark.slow` - æ™‚é–“ã®ã‹ã‹ã‚‹ãƒ†ã‚¹ãƒˆ

## å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹

1. **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: [pytest.org](https://docs.pytest.org/)
2. **å®Ÿè·µä¾‹**: [pytest_example_test.py](pytest_example_test.py) ã‚’å‚ç…§
3. **è©³ç´°ã‚¬ã‚¤ãƒ‰**: [pytest_concepts_and_usage.md](pytest_concepts_and_usage.md) ã‚’ç†Ÿèª­

## ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### ã‚ˆãã‚ã‚‹å•é¡Œ

1. **pytestãŒè¦‹ã¤ã‹ã‚‰ãªã„**
   ```bash
   uv run pytest --version  # é–‹ç™ºç’°å¢ƒã§å®Ÿè¡Œ
   ```

2. **çµ±åˆãƒ†ã‚¹ãƒˆãŒã‚¹ã‚­ãƒƒãƒ—ã•ã‚Œã‚‹**
   ```bash
   set RUN_INTEGRATION_TESTS=1
   ```

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼**
   - DockerãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèª
   - ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãŒåˆ©ç”¨å¯èƒ½ã‹ç¢ºèª

### ãƒ‡ãƒãƒƒã‚°ã®ãƒ’ãƒ³ãƒˆ

```bash
# è©³ç´°ãªå‡ºåŠ›ã§å®Ÿè¡Œ
uv run pytest -v

# æœ€åˆã®å¤±æ•—ã§åœæ­¢
uv run pytest -x

# ç‰¹å®šã®ãƒ†ã‚¹ãƒˆã®ã¿å®Ÿè¡Œ
uv run pytest test/unit/test_config.py::TestPostgresConfig::test_default_values
```

## è²¢çŒ®ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

æ–°ã—ã„ãƒ†ã‚¹ãƒˆã‚’è¿½åŠ ã™ã‚‹éš›ã¯ï¼š

1. é©åˆ‡ãªãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«é…ç½®ï¼ˆunit/integrationï¼‰
2. é©åˆ‡ãªãƒãƒ¼ã‚«ãƒ¼ã‚’ä»˜ä¸
3. æ˜ç¢ºãªãƒ†ã‚¹ãƒˆåã¨docstringã‚’è¨˜è¿°
4. å¿…è¦ãªfixtureã‚’ä½¿ç”¨
5. ãƒ†ã‚¹ãƒˆãŒç‹¬ç«‹ã—ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª

---

ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãŒpytestã®åŠ¹æœçš„ãªä½¿ç”¨ã«å½¹ç«‹ã¤ã“ã¨ã‚’é¡˜ã£ã¦ã„ã¾ã™ï¼
