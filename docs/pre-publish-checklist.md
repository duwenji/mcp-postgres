# PyPI公開前チェックリスト

このチェックリストを使用して、PyPIへの公開前にすべての項目が完了していることを確認してください。

## プロジェクト設定

### [ ] 1. プロジェクトメタデータの確認
- [ ] `pyproject.toml` の `name` が適切で一意である
- [ ] `version` がセマンティックバージョニングに従っている
- [ ] `description` が明確で簡潔である
- [ ] `authors` に正しい名前とメールアドレスが設定されている
- [ ] `requires-python` が適切に設定されている
- [ ] `keywords` に関連するキーワードが含まれている
- [ ] `classifiers` が適切に設定されている

### [ ] 2. 依存関係の確認
- [ ] すべての必須依存関係が `dependencies` に含まれている
- [ ] 依存関係のバージョンが適切に指定されている
- [ ] 開発依存関係が `dev` セクションに分離されている
- [ ] 依存関係にセキュリティ脆弱性がない

### [ ] 3. スクリプトとエントリーポイント
- [ ] `[project.scripts]` セクションが正しく設定されている
- [ ] エントリーポイントスクリプトが正しく動作する

## コード品質

### [ ] 4. コードの検証
- [ ] すべてのPythonファイルが構文エラーなくインポートできる
- [ ] 型ヒントが適切に使用されている
- [ ] ドキュメント文字列が主要な関数/クラスに含まれている
- [ ] コードがPEP8スタイルガイドに従っている

### [ ] 5. テストの実行
- [ ] すべての単体テストが通過する
- [ ] 統合テストが通過する
- [ ] テストカバレッジが適切である
- [ ] エッジケースがテストされている

### [ ] 6. 静的解析
- [ ] リンター（flake8など）がエラーを報告しない
- [ ] 型チェッカー（mypyなど）がエラーを報告しない
- [ ] コードフォーマッター（blackなど）が適用されている

## ドキュメント

### [ ] 7. READMEファイル
- [ ] README.md が完全で最新である
- [ ] インストール手順が明確に記載されている
- [ ] 使用方法の例が含まれている
- [ ] 設定方法が説明されている
- [ ] トラブルシューティングガイドが含まれている
- [ ] ライセンス情報が明記されている

### [ ] 8. 追加ドキュメント
- [ ] APIドキュメントが生成できる
- [ ] 変更履歴（CHANGELOG）が更新されている
- [ ] 貢献ガイドラインが含まれている

## ビルドと配布

### [ ] 9. ビルドの準備
- [ ] `pyproject.toml` の `build-system` が正しく設定されている
- [ ] 必要なビルド依存関係がインストールされている
- [ ] パッケージが正常にビルドできる

### [ ] 10. パッケージ内容の確認
- [ ] すべての必要なファイルがパッケージに含まれている
- [ ] 不要なファイルが除外されている（`.gitignore`を確認）
- [ ] ライセンスファイルが含まれている

## セキュリティ

### [ ] 11. セキュリティチェック
- [ ] 機密情報がコードに含まれていない
- [ ] 環境変数が安全に使用されている
- [ ] SQLインジェクション対策が実装されている
- [ ] 依存関係に既知の脆弱性がない

### [ ] 12. 権限設定
- [ ] ファイル権限が適切に設定されている
- [ ] 実行可能ファイルに適切な権限が設定されている

## テスト公開

### [ ] 13. テストPyPIでの検証
- [ ] テストPyPIに正常にアップロードできる
- [ ] テストPyPIから正常にインストールできる
- [ ] インストール後の基本的な機能が動作する
- [ ] エントリーポイントスクリプトが正しく動作する

### [ ] 14. クロスプラットフォーム互換性
- [ ] Windowsで正常に動作する
- [ ] macOSで正常に動作する
- [ ] Linuxで正常に動作する

## 最終確認

### [ ] 15. 最終チェック
- [ ] パッケージ名が利用可能であることを確認
- [ ] バージョン番号が重複していないことを確認
- [ ] すべてのリンクが正しく機能する
- [ ] メタデータがPyPIの要件を満たしている

### [ ] 16. バックアップ計画
- [ ] 公開前のコード状態のバックアップがある
- [ ] ロールバック手順が準備されている

## チェックリストの使用方法

### 自動チェックスクリプト

以下のスクリプトを使用して自動チェックを実行できます：

```bash
#!/bin/bash
# scripts/pre_publish_check.sh

echo "=== PyPI公開前チェックリスト ==="

# 1. 構文チェック
echo "1. 構文チェック..."
python -m py_compile src/*.py src/tools/*.py

# 2. テスト実行
echo "2. テスト実行..."
uv run pytest

# 3. 型チェック
echo "3. 型チェック..."
uv run mypy src/

# 4. リンター実行
echo "4. リンター実行..."
uv run flake8 src/

# 5. ビルドテスト
echo "5. ビルドテスト..."
python -m build

echo "チェック完了！"
```

### 手動チェック項目

自動化できない項目は手動で確認：

```bash
# パッケージ内容の確認
tar -tzf dist/mcp-postgres-*.tar.gz | head -20

# メタデータの確認
python -c "
import tomli
with open('pyproject.toml', 'rb') as f:
    data = tomli.load(f)
print('Project:', data['project']['name'])
print('Version:', data['project']['version'])
print('Description:', data['project']['description'])
"
```

## トラブルシューティング

### よくある問題と解決策

| 問題 | 解決策 |
|------|--------|
| ビルドエラー | `dist/` と `build/` ディレクトリを削除して再ビルド |
| 依存関係エラー | `uv.lock` を削除して `uv sync` を再実行 |
| テスト失敗 | テスト環境を確認し、必要なサービスが起動しているか確認 |
| アップロードエラー | APIトークンとパッケージ名を確認 |

### 緊急時の対応

公開後に問題が発見された場合：

1. **即時対応**
   - 問題の影響範囲を特定
   - ユーザーへの通知を準備

2. **修正リリース**
   - パッチバージョンを迅速にリリース
   - 変更履歴を更新

3. **予防策**
   - テストカバレッジの向上
   - 継続的インテグレーションの強化

このチェックリストをすべて完了したら、PyPIへの公開を進めてください。
