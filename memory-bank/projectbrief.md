# Project Brief: PostgreSQL MCP Server

## プロジェクト概要
PostgreSQLデータベースとの高度な連携を提供するMCP（Model Context Protocol）サーバーです。このサーバーは、AIアシスタントがPostgreSQLデータベースに対して以下の機能を安全かつ効率的に実行できるようにします：

- **データベース操作**: 基本的なCRUD操作から複雑なクエリ実行まで
- **スキーマ管理**: テーブル作成、変更、削除を含む完全なスキーマ管理
- **データ分析**: MCP Sampling機能によるLLM連携での高度なデータ分析
- **環境自動構築**: DockerによるPostgreSQL環境の自動セットアップ
- **データ品質改善**: 正規化、データ品質評価、スキーマ最適化

## コア要件

### 1. データベース接続管理
- PostgreSQLデータベースへの安全な接続
- 接続プーリングによる効率的なリソース管理
- 環境変数による柔軟な設定管理
- **Docker自動セットアップ**: MCPサーバー起動時のPostgreSQLコンテナ自動起動

### 2. 提供する操作

#### 基本データ操作
- SQLクエリの実行と結果処理
- データの挿入・更新・削除（CRUD操作）
- トランザクション管理
- データベースメタデータの取得

#### スキーマ管理
- テーブルの作成、変更、削除
- カラム定義の管理
- 制約の設定と管理

#### MCP Sampling連携による高度な分析
- **正規化分析**: データベース正規化レベルの自動評価と改善計画生成
- **データ品質評価**: 完全性、正確性、一貫性などの品質次元の包括的評価
- **スキーマ最適化**: パフォーマンスと保守性のためのスキーマ改善提案
- **関係性分析**: テーブル間の依存関係と正規化状態の分析

### 3. セキュリティ要件
- 接続情報の安全な管理（環境変数）
- SQLインジェクション対策（パラメータ化クエリ）
- 適切なエラーハンドリングとロギング
- 入力バリデーションと権限制御

## 主要目標
- AIアシスタントがPostgreSQLデータベースと直接対話できる高度なプラットフォームを提供
- 安全で信頼性の高いデータベース操作と分析機能を実装
- MCP Sampling機能によるLLM連携でインテリジェントなデータ分析を実現
- Dockerによる自動環境構築で設定の容易性を確保
- 拡張性の高いアーキテクチャで将来の機能追加を容易にする

## 技術スタック
- **プログラミング言語**: Python 3.10+
- **データベース接続**: psycopg2-binary (PostgreSQLアダプター)
- **MCPフレームワーク**: 標準MCPプロトコル実装
- **コンテナ管理**: Docker SDK (自動環境構築)
- **設定管理**: Pydantic + 環境変数
- **パッケージ管理**: uv
- **非同期処理**: asyncio

## 成功基準
- PostgreSQLデータベースへの安全な接続が確立できる
- 基本的なCRUD操作から高度な分析機能まで包括的に実行できる
- MCP Sampling機能によるLLM連携が正常に動作する
- Dockerによる自動環境構築がシームレスに動作する
- 適切なエラーハンドリングとセキュリティ対策が実装されている
- 設定が容易で運用がシンプルである

## 実装済みの主要機能

### データベース操作ツール
- `create_entity`, `read_entity`, `update_entity`, `delete_entity`
- `get_tables`, `get_table_schema`, `get_database_info`

### テーブル管理ツール
- `create_table`, `alter_table`, `drop_table`

### MCP Sampling分析ツール
- `request_llm_analysis`: LLMによる包括的なデータ分析
- `generate_normalization_plan`: 正規化計画の生成
- `assess_data_quality`: データ品質の評価
- `optimize_schema_with_llm`: スキーマ最適化の提案

### Docker自動構築
- MCPサーバー起動時のPostgreSQLコンテナ自動起動
- 環境変数による柔軟な設定
- コンテナ状態の自動監視と管理
