# Active Context: PostgreSQL MCP Server

## 現在の作業状況

### 現在の焦点
- **Dockerテスト環境の修正完了**: uvインストールエラーの解決
- **次のステップ**: PostgreSQL MCPサーバーの実装開始

### 最近の変更
1. **Dockerテスト環境の修正** (完了)
   - **問題**: uvのインストールスクリプトが変更され、インストール先が `/root/.cargo/bin/uv` から `/root/.local/bin/uv` に移動
   - **修正**: Dockerfile.testのuvインストールコマンドを更新
   - **追加修正**: README.mdファイルのコピーを追加（pyproject.tomlのreadme設定に対応）

2. **Memory Bankファイルの作成** (完了)
   - `projectbrief.md`: プロジェクト概要と要件定義
   - `productContext.md`: 製品コンテキストとユースケース
   - `techContext.md`: 技術スタックと開発環境
   - `systemPatterns.md`: システムアーキテクチャと設計パターン

3. **技術スタックの決定** (完了)
   - プログラミング言語: Python
   - データベース接続: psycopg2
   - MCPフレームワーク: 標準MCPプロトコル

## アクティブな決定と考慮事項

### 技術的決定
1. **Pythonの採用**: ユーザーの要望に基づきPythonを採用
2. **psycopg2の使用**: 安定したPostgreSQL接続ライブラリ
3. **環境変数による設定管理**: セキュリティと柔軟性の確保

### 設計上の考慮事項
- **接続プーリング**: 効率的なリソース管理の実装
- **非同期処理**: スケーラビリティの確保
- **セキュリティ**: SQLインジェクション対策と適切なエラーハンドリング

## 次のステップ

### 即時アクション (Phase 2: 設計)
1. **プロジェクト構造の作成**
   - 基本的なディレクトリ構造の設定
   - 依存関係ファイルの作成
   - 設定ファイルのテンプレート作成

2. **コアコンポーネントの設計**
   - データベース接続層の設計
   - MCPツールインターフェースの定義
   - エラーハンドリング戦略の確立

### 短期目標 (Phase 3: 実装)
1. **基本的なMCPサーバーの実装**
2. **PostgreSQL接続機能の実装**
3. **コアツールの実装（クエリ実行、テーブル取得など）**
4. **テスト環境の構築**

## 重要なパターンと選好

### コーディング規約
- **型ヒントの使用**: コードの明瞭性とメンテナンス性向上
- **非同期プログラミング**: パフォーマンスとスケーラビリティ
- **構造化ロギング**: デバッグと監視の容易化

### 設定管理
- **環境変数優先**: セキュリティと環境ごとの設定切り替え
- **バリデーション**: Pydanticによる設定値の検証
- **デフォルト値**: 合理的なデフォルト設定の提供

### エラーハンドリング
- **詳細なエラーメッセージ**: デバッグの容易化
- **適切なロギングレベル**: 運用時の問題特定
- **ユーザーフレンドリーなエラー**: AIアシスタントへの適切なフィードバック

## 学習とプロジェクトの洞察

### 重要な学び
1. **MCPプロトコルの理解**: AIアシスタントとの効率的な連携方法
2. **PostgreSQL接続のベストプラクティス**: セキュリティとパフォーマンスの両立
3. **非同期Pythonプログラミング**: 現代的なサーバー実装のパターン

### プロジェクトの進化
- **初期要件**: 基本的なデータベース操作の提供
- **拡張可能性**: 将来の機能追加を見据えた設計
- **運用のしやすさ**: 設定とデプロイの簡素化

## 現在の課題と解決策

### 課題1: スキーマ情報の外部提供手段の欠如
- **状況**: AIがPostgreSQLのテーブルデータを参考にツールを呼ぶか否かを決定する際に、MCPサーバがこれらの情報を外に出す手段がない
- **解決策**: スキーマ取得ツールとリソース機能の実装
  - `get_tables`: 全テーブル一覧取得ツール
  - `get_table_schema`: テーブル詳細スキーマ取得ツール
  - スキーマリソースの実装

### 課題2: 接続プールの最適化
- **状況**: 効率的なリソース管理が必要
- **解決策**: SQLAlchemyまたは独自実装による接続プーリング

### 課題3: セキュリティ対策
- **状況**: SQLインジェクションのリスク
- **解決策**: パラメータ化クエリと入力バリデーション

### 課題4: エラーハンドリング
- **状況**: 様々なエラーケースへの対応
- **解決策**: 階層的なエラーハンドリングと適切なロギング

## 優先順位

### 高優先度
1. 基本的なMCPサーバー構造の実装
2. PostgreSQL接続機能の実装
3. コアツール（クエリ実行、テーブル取得）の実装

### 中優先度
1. 設定管理システムの実装
2. エラーハンドリングの強化
3. テスト環境の構築

### 低優先度
1. 高度な機能の実装
2. 監視とロギングの強化
3. ドキュメントの充実

## 次のアクション
1. **プロジェクト構造の作成** (`src/` ディレクトリと基本ファイル)
2. **依存関係の定義** (`requirements.txt` の作成)
3. **設定システムの実装** (環境変数とPydanticモデル)
4. **基本的なMCPサーバーの実装** (Hello Worldレベルの動作確認)
